find_package(Protobuf REQUIRED)
include_directories($PROTOBUF_INCLUDE_DIRS})
file(GLOB PROTO_FILES "${CMAKE_CURRENT_SOURCE_DIR}/*.proto")
PROTOBUF_GENERATE_CPP(DFI_PROTO_SRC PROTO_HDRS ${PROTO_FILES})
set(DFI_MESSAGE_SRC
  MessageTypes.h
  ) # Adding headers required for portability reasons http://voices.canonical.com/jussi.pakkanen/2013/03/26/a-list-of-common-cmake-antipatterns/


set(DFIProtobufIncludePath ${CMAKE_CURRENT_BINARY_DIR}
  CACHE INTERNAL "Path to generated protobuf files.")

# As the protobuf files are generated by the build process, they will not be found
# when collecting the sources for building the shared library.
set(DFI_PROTO_SRC ${DFI_PROTO_SRC} CACHE INTERNAL "Generated protobuf source files")

add_library(dfi_message ${DFI_MESSAGE_SRC} ${DFI_PROTO_SRC} ${PROTO_HDRS})
target_include_directories(dfi_message PUBLIC ${CMAKE_CURRENT_BINARY_DIR})
target_link_libraries(dfi_message
  ${PROTOBUF_LIBRARIES}
)
